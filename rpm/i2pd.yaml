Name: i2pd
Summary: End-to-End encrypted and anonymous Internet daemon
Version: 2.41.0
Release: 2
Group: Applications/Internet
License: BSD-3-Clause and Apache-2.0
URL: https://i2pd.website
SCM: https://github.com/PurpleI2P/i2pd
Sources:
    - '%{name}-%{version}.tar.gz'
    - '%{name}.conf'
    - '%{name}.service'
    - 'openssl-family.cnf'
Description: |
    %{summary}.

    I2P (Invisible Internet Protocol) is a universal anonymous network layer.
    All communications over I2P are anonymous and end-to-end encrypted,
    participants don't reveal their real IP addresses.

    I2P client is a software used for building and using anonymous I2P
    networks. Such networks are commonly used for anonymous peer-to-peer
    applications (filesharing, cryptocurrencies) and anonymous client-server
    applications (websites, instant messengers, chat-servers).

    I2P allows people from all around the world to communicate and share
    information without restrictions.

    Notices for SailfishOS:
      - the config lives in `/home/.system/var/lib/i2pd`, not `/etc`
      - the web console is reachable at http://127.0.0.1:7070
      - join the 'sailfishos' family!
      - for more information, se the README at https://github.com/nephros/i2pd/blob/main/README.md

    %if "%{?vendor}" == "chum"
    PackageName: I2Pd
    Type: console-application
    PackagerName: nephros
    Categories:
     - Network
     - P2P
    Custom:
      Repo: https://github.com/PurpleI2P/i2pd
      PackagingRepo: https://github.com/nephros/i2pd
    Icon: https://i2pd.website/images/favicon.png
    Url:
      Homepage: https://i2pd.website
      Help: https://i2pd.readthedocs.io/en/latest
      Donations: https://i2pd.website/#donations
    %endif
SetupOptions: -q -n %{name}-%{version}/upstream
Macros:
  - 'custom_vardir;/home/.system/%{_var}/lib'
#Patches:
#  - 'baz'
Requires:
  - systemd
RequiresPost:
  - systemd
RequiresPostUn:
  - systemd
PkgBR:
  - gcc-c++
  - cmake
  - boost-devel >= 1.49
  - systemd
  # for the "family" stuff, need openssl binary
  - openssl
  # for the UI:
  - qt5-qmake
  - sailfish-svg2png
PkgConfigBR:
  - libssl
  - zlib
Configure: cmake
ConfigOptions:
  - -DCMAKE_BUILD_TYPE=Release
  # -DWITH_AESNI=%ifarch %ix86
  # -DWITH_BINARY=ON
  # -DWITH_LIBRARY=ON
  # -DWITH_STATIC=OFF
  # -DWITH_UPNP=OFF
  # -DWITH_ADDRSANITIZER=ON
  # -DWITH_THREADSANITIZER=ON
Builder: none
NoIconCache: true
Files:
  - '%license LICENSE'
  - '%{_unitdir}/%{name}.service'
  - '%{_bindir}/%{name}'
  - '%{_libdir}/*.so'
  - '%attr(775,root,inet) %dir %{custom_vardir}/%{name}'
  - '%attr(770,root,inet) %dir %{custom_vardir}/%{name}/tunnels.d'
  - '%attr(775,root,inet) %dir %{custom_vardir}/%{name}/addressbook'
  - '%{custom_vardir}/%{name}/certificates/*/*'
  - '%attr(640,root,inet) %config %{custom_vardir}/%{name}/family/sailfishos.crt'
  - '%attr(640,root,inet) %config %{custom_vardir}/%{name}/family/sailfishos.key'
  - '%attr(640,root,inet) %config(noreplace) %{custom_vardir}/%{name}/%{name}.conf'
  - '%config(noreplace) %{custom_vardir}/%{name}/%{name}.conf.example'
  - '%config(noreplace) %{custom_vardir}/%{name}/tunnels.conf.example'



SubPackages:
    - Name:  ui
      Summary: UI components for %{name}
      Group: Applications/Internet
      License: Apache-2.0 and public domain
      BuildArch: noarch
      NoIconCache: true
      AutoDepend: no
      Requires:
        - '%{name}'
        - 'jolla-settings'
      Files:
        - '%{_datadir}/%{name}-ui/*'
        - '%{_datadir}/jolla-settings/entries/i2pd.json'
        - '%{_datadir}/jolla-settings/pages/i2p/*'
        - '%{_datadir}/themes/*/meegotouch/*/icons/*'
      Description: |
          %{summary}.

          This package is the companion/settings app for I2Pd.

          I2P (Invisible Internet Protocol) is a universal anonymous network layer.
          All communications over I2P are anonymous and end-to-end encrypted,
          participants don't reveal their real IP addresses.

          %if "%{?vendor}" == "chum"
          PackageName: I2Pd Settings UI
          Type: desktop-application
          PackagerName: nephros
          Categories:
           - Network
           - P2P
          Custom:
            PackagingRepo: https://github.com/nephros/i2pd
          Icon: https://i2pd.website/images/favicon.png
          %endif
